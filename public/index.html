<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Viaturas</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Tela Inicial -->
    <div id="initialScreen" class="screen active">
        <h1>Dashboard de Viaturas da Aeronáutica</h1>
        <img src="https://www.forte.jor.br/wp-content/uploads/2012/09/foto-abre-grande-dentro.jpg" alt="Viatura da Aeronáutica" class="viatura-image">
        <h2>Histórico Semanal de Viaturas</h2>
        <table id="weeklyTotalsTable">
            <thead>
                <tr>
                    <th>Semana</th>
                    <th>Total de Viaturas</th>
                </tr>
            </thead>
            <tbody id="weeklyTotalsTableBody"></tbody>
        </table>
        <p id="initialError" class="error"></p>
        <button onclick="showUploadScreen()">Fazer Upload de Nova Planilha</button>
        <button onclick="showHistoryScreen()">Ver Histórico Completo</button>
    </div>

    <!-- Tela de Upload -->
    <div id="uploadScreen" class="screen">
        <h1>Upload de Planilha</h1>
        <input type="file" id="fileInput" accept=".xlsx,.xls">
        <p id="uploadError" class="error"></p>
        <button onclick="processFile()">Processar Planilha</button>
        <button onclick="goBackToInitial()">Voltar</button>
    </div>

    <!-- Tela de Filtro -->
    <div id="filterScreen" class="screen">
        <h1>Filtrar Unidades</h1>
        <h2>Unidades do SISTRAN</h2>
        <div id="sistranUnitsList"></div>
        <h2>Outras Unidades</h2>
        <div id="otherUnitsList"></div>
        <p id="filterError" class="error"></p>
        <button onclick="applyUnitFilter()">Aplicar Filtro</button>
        <button onclick="skipUnitFilter()">Prosseguir sem Filtrar</button>
        <button onclick="goBackToInitial()">Voltar</button>
    </div>

    <!-- Tela de Análise -->
    <div id="analysisScreen" class="screen">
        <h1>Análise de Viaturas</h1>
        <p>Total de Registros: <span id="totalRecords">0</span></p>
        <p id="analysisError" class="error"></p>
        <button onclick="showUnitCountChart()">Gráfico por Unidade</button>
        <button onclick="showStatusCountChart()">Gráfico por Status</button>
        <button onclick="showAvailabilityTable()">Tabela de Disponibilidade</button>
        <button onclick="showHistoryScreen()">Ver Histórico</button>
        <button onclick="goBack()">Voltar</button>
        <div id="unitChartContainer" style="display: none;">
            <canvas id="unitChart"></canvas>
        </div>
        <div id="statusChartContainer" style="display: none;">
            <canvas id="statusChart"></canvas>
        </div>
        <div id="availabilityTableContainer" style="display: none;">
            <button id="generateChartButton" onclick="showAvailabilityChart()" style="display: none;">Gerar Gráfico</button>
            <button id="backToTableButton" onclick="showAvailabilityTable()" style="display: none;">Voltar para Tabela</button>
            <table id="availabilityTable" style="display: none;">
                <thead>
                    <tr>
                        <th onclick="sortTable('unit')">Unidade</th>
                        <th onclick="sortTable('available')">Disponíveis</th>
                        <th onclick="sortTable('unavailable')">Indisponíveis</th>
                        <th onclick="sortTable('total')">Total</th>
                    </tr>
                </thead>
                <tbody id="availabilityTableBody"></tbody>
            </table>
            <canvas id="availabilityChart" style="display: none;"></canvas>
        </div>
    </div>

    <!-- Tela de Histórico -->
    <div id="historyScreen" class="screen">
        <h1>Histórico de Viaturas</h1>
        <select id="historyDateSelect">
            <option value="">Selecione uma data</option>
        </select>
        <button onclick="showHistoricalData()">Exibir Dados</button>
        <button onclick="exportHistory()">Exportar Histórico</button>
        <button onclick="triggerImportHistory()">Importar Histórico</button>
        <input type="file" id="importHistoryInput" accept=".json" style="display: none;" onchange="importHistory()">
        <button onclick="deleteDuplicates()">Excluir Duplicatas</button>
        <p id="historyError" class="error"></p>
        <div id="historyChartContainer">
            <canvas id="historyChart"></canvas>
        </div>
        <button onclick="goBackFromHistory()">Voltar</button>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>